name: Update Product Formula in Tap
# This workflow will automatically update our product formulae on the release of
# new versions
on:
  repository_dispatch:
    types: [version-updated]
    # this event type is set in the repository dispatch event
#    inputs:
#      name:
#        description: 'name of the formula being updated'
#        required: true
#      sha256:
#        description: 'SHA256 of updated product zip'
#        required: true
#      version:
#        description: 'most current product version number'
#        required: true

jobs:
  formula-bump-pr:
    name: Create PR
    runs-on: ubuntu-latest
    steps:
      - name: kpenfound fork of dawidd6 Homebrew bump formula
        uses: kpenfound/action-homebrew-bump-formula@v3.2.3
        with:
          token: ${{secrets.HOMEBREW_TOKEN}}
          tap: hashicorp/homebrew-tap
          formula: ${{github.event.client_payload.name}}
          tag: ${{github.event.client_payload.version}}
      - name: Merge pull requests
          uses: pascalgn/automerge-action@v0.8.4
          env:
            GITHUB_TOKEN: "${{secrets.HOMEBREW_TOKEN}}"
            MERGE_LABELS: ""
            MERGE_FILTER_AUTHOR: "Omar-Khawaja"
